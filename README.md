# Задача на паттерн проектирования Цепочка обязанностей

В этой задаче вам предлагается разработать конвейер обработчиков электронных писем:
```
struct Email {
  string from;
  string to;
  string body;
};
```
Обработчики должны реализовывать абстрактный класс Worker:
```
class Worker {
public:
  virtual void Process(unique_ptr<Email> email) = 0;
  virtual void Run() {
    // только первому worker-у в пайплайне нужно реализовать этот метод
    throw logic_error("Unimplemented");
  }

public:
  void SetNext(unique_ptr<Worker> worker);
};
```
Также реализуйте обработчики Reader, Filter, Copier и Sender, наследующие от класса Worker, а также класс PipelineBuilder, конструирующий цепочку обработчиков:  
```
class PipelineBuilder {
public:
  // добавляет в качестве первого обработчика Reader
  explicit PipelineBuilder(istream& in);

  // добавляет новый обработчик Filter
  PipelineBuilder& FilterBy(Filter::Function filter);

  // добавляет новый обработчик Copier
  PipelineBuilder& CopyTo(string recipient);

  // добавляет новый обработчик Sender
  PipelineBuilder& Send(ostream& out);

  // строит цепочку с помощью метода Worker::SetNext и возвращает первый обработчик в построенной цепочке
  unique_ptr<Worker> Build();
};
```
Требования:

Worker

   * метод SetNext должен принимать во владение следующий обработчик из цепочки

Reader

   * конструктор должен принимать входной поток (istream&), из которого нужно читать сообщения

   * метод Run должен читать из входного потока все e-mail'ы и передавать дальше каждый из них. Один e-mail представляется во входном потоке полями from, to, body, каждое из которых находится на своей строке.

Filter

   * конструктор должен принимать предикат типа function<bool(const Email&)>

   * метод Process должен передавать дальше только сообщения, удовлетворяющие предикату

Copier

   * конструктор должен принимать строку-адрес получателя

   * метод Process должен передавать сообщение как исходному получателю, так и указанному
    в конструкторе. В случае, если они совпадают, дублировать сообщение не нужно

Sender

   * конструктор должен принимать поток для записи сообщений

   * метод Process должен записывать сообщения в поток в том же формате, в котором они были прочитаны

Все обработчики должны передавать сообщения дальше, если обратное не требуется явно.

PipelineBuilder

   * Конструктор должен инициализировать цепочку обработчиков обработчиком Reader с переданным потоком.

   * Методы с типом возврата PipelineBuilder& должны возвращать ссылку на экземпляр класса, для которого они были вызваны, а также добавлять в конец цепочки новый обработчик, соответствующий вызванному методу (Filter для метода FilterBy, Sender для метода Send и т.д.).

   * Метод Build должен возвращать готовую цепочку обработчиков; подразумевается, что после его завершения экземпляр PipelineBuilder больше использоваться не будет
